# 🎖️ 里程碑 3：实战综合测试

**完成第 15-21 章后进行本测试**  
**预计用时：4-6 小时（可分两天完成）**

---

## 📋 测试说明

本测试分为三部分：

1. **理论测试**（45 分钟）- 扩展机制与工程规范理解
2. **实践测试**（3-4 小时）- 端到端实现与验证能力
3. **代码审查与复盘**（45 分钟）- 质量评估与优化能力

**通过标准：**

- 理论测试：≥ 70%
- 实践测试：完成全部必做项，且核心链路可运行
- 代码审查：关键风险识别完整，改进建议可执行

---

## 📝 Part 1: 理论测试（45 分钟）

### 选择题（每题 5 分，共 50 分）

#### Q1: 自定义 Tool 中，哪一项用于描述参数结构？
- A. `description`
- B. `parameters`
- C. `metadata`
- D. `schema_version`

#### Q2: 新增 Channel 时，出站消息串发给错误平台，最可能先检查？
- A. Provider 温度参数
- B. Session 文件大小
- C. outbound 过滤条件
- D. Cron 表达式

#### Q3: Provider 抽象层的核心价值是？
- A. 持久化用户会话
- B. 统一不同模型平台的调用接口
- C. 替代 MessageBus
- D. 自动修复工具报错

#### Q4: Skill 文档（`SKILL.md`）最关键的作用是？
- A. 存储用户聊天历史
- B. 指导模型在特定任务中的行为边界与输出规范
- C. 替代所有系统 Prompt
- D. 配置数据库连接

#### Q5: 为异步逻辑写测试时，最常见必需能力是？
- A. `pytest.mark.asyncio`
- B. `threading.Lock`
- C. `subprocess.Popen`
- D. `@dataclass`

#### Q6: 性能排查“三段式”中不包含以下哪项？
- A. 入口（消息进入）
- B. 中段（Agent/工具执行）
- C. 出口（Channel 发送）
- D. UI 动画帧率

#### Q7: 贡献代码时，最推荐的提交方式是？
- A. 一个 PR 混合多个无关重构
- B. 小步提交，单一主题
- C. 先改功能，测试与文档后补
- D. 不跑测试直接提交

#### Q8: 自定义 Tool 的错误处理最佳实践是？
- A. 捕获错误后静默忽略
- B. 直接抛原始异常给用户
- C. 返回可读、可行动的错误信息
- D. 遇错立即退出进程

#### Q9: 新增 Provider 后，哪个环节最容易遗漏？
- A. README 目录结构
- B. Provider 注册和选择逻辑
- C. Python 版本号
- D. Shell 执行权限

#### Q10: 下列哪项最符合“可审查 PR”的标准？
- A. 仅给结论，不给测试结果
- B. 只给代码，不给风险说明
- C. 说明改动点、测试范围、兼容性影响
- D. 提交信息随意填写

### 简答题（每题 10 分，共 50 分）

#### Q11: 说明“自定义 Tool + Skill + Channel”在一个运维助手场景中的协作流程。

#### Q12: 解释新增 Provider 时，为什么要把“可用性失败”与“调用超时失败”区分处理。

#### Q13: 给出你为一个自定义 Channel 设计的最小测试集（至少 4 条）。

#### Q14: 如果你发现 Agent 响应变慢，请按“入口-中段-出口”给出排查顺序和观测指标。

#### Q15: 描述一份高质量 PR 描述应包含哪些部分，并说明每部分的作用。

---

## 🔧 Part 2: 实践测试（3-4 小时）

### 综合任务：开发“运维助手”功能

请完成一个可运行的最小版本，包含以下必做项：

### 任务 1：自定义 Tool（必做，60 分钟）

目标：实现“系统健康检查 Tool”。

最低要求：

- 提供 CPU、内存、磁盘占用信息
- 支持可选参数（如阈值或检查项）
- 返回结构化、可读结果
- 错误场景有清晰提示

**提交内容：**

- 工具代码路径
- 参数 schema 截图或片段
- 一次真实调用结果

### 任务 2：新增/扩展 Channel（必做，45 分钟）

目标：实现一个可验证收发的自定义渠道（如 HTTP Webhook）。

最低要求：

- 入站请求可转为 `InboundMessage`
- 出站消息可按 channel/chat_id 正确过滤
- 启停流程稳定（start/stop）

**提交内容：**

- 启动命令
- 一次入站请求与一次出站结果
- 关键日志片段

### 任务 3：新增 Provider（必做，45 分钟）

目标：接入一个新 Provider（推荐 Ollama 本地模型）。

最低要求：

- Provider 类实现与注册完成
- CLI/Gateway 能正确选择该 Provider
- 不可用时给出友好错误

**提交内容：**

- 配置片段
- 正常调用输出
- 故障场景演示（服务关闭或超时）

### 任务 4：开发 Skill 包（必做，30 分钟）

目标：新增“故障排查 Skill”。

最低要求：

- 完整 `SKILL.md`
- 定义输入约束与输出模板
- 明确可调用工具和边界

**提交内容：**

- Skill 文件路径
- 一次实际触发对话记录

### 任务 5：测试与质量门禁（必做，45 分钟）

目标：为新增能力提供最小测试保障。

最低要求：

- 至少 4 条测试（建议：Tool 2 条 + Channel 1 条 + Provider/Skill 1 条）
- 通过本地测试
- 代码风格检查通过（如 ruff）

**提交内容：**

- 测试命令与结果
- 失败修复前后说明（至少 1 个）

---

## 🕵️ Part 3: 代码审查与复盘（45 分钟）

### 审查题 A：设计评审

请用你完成的“运维助手”实现，回答：

1. 当前设计中最容易扩展的模块是什么？为什么？
2. 当前设计中最脆弱的模块是什么？如何改进？
3. 如果并发请求翻倍，哪里最可能成为瓶颈？

### 审查题 B：风险识别

列出至少 5 个潜在风险，并给出缓解措施。建议覆盖：

- 安全风险（命令执行、路径越界、密钥泄漏）
- 稳定性风险（超时、重试风暴、任务泄漏）
- 可维护性风险（耦合高、测试不足、文档缺失）

### 审查题 C：提交质量

给你的最终 PR 做一次自审，至少包含：

- 改动范围是否单一
- 测试是否覆盖关键路径
- 文档是否可让他人复现
- 是否存在明显无关改动

---

## 📤 提交建议

- 理论题答案（Markdown）
- 实践任务操作记录（命令 + 关键输出）
- 代码审查与复盘结论
- 最终 PR 描述草稿（可直接用于 GitHub）

---

## ✅ 自我评估

- [ ] 理论测试得分 ≥ 70 分
- [ ] 5 个实践任务全部完成
- [ ] 端到端链路可稳定运行
- [ ] 至少 4 条测试通过
- [ ] 能清楚说明架构取舍与后续优化方向

**若全部通过，恭喜你完成 nanobot 学习主线！🎉**

---

## 📚 复习建议

如果未达标，建议按以下顺序补强：

1. **功能缺失优先**：回看第 15-18 章，先补齐扩展能力
2. **质量不足其次**：回看第 19-20 章，补测试与性能排查
3. **工程化收尾**：回看第 21 章，完善贡献流程与文档

---

## 🚀 下一步建议

1. 挑选 1 个真实需求做 mini feature（从 issue 或日常痛点选）
2. 按本里程碑模板再做一次完整闭环演练
3. 向社区提交首个可合并 PR

**学习进度：** [█████████████████████] 21/21 章节全部完成！
