# 第 21 章：贡献代码与最佳实践

**预计学习时间：2 小时**  
**难度：⭐⭐⭐**

---

## 📚 本章目标

- 熟悉 nanobot 项目的贡献流程
- 掌握代码风格与提交规范
- 学会准备可审查、可合并的 Pull Request
- 建立长期维护的工程习惯

---

## 📖 理论学习（30 分钟）

### 1. 贡献流程总览

典型流程：

```
Fork → 新建分支 → 开发与测试 → 提交 PR → Review → 合并
```

核心原则：

- 小步提交，单一主题
- 变更最小化，避免无关改动
- 提交前本地验证可通过

### 2. 代码风格与质量门槛

建议统一执行：

- 格式化与静态检查（如 ruff）
- 关键路径测试（尤其是你改动的模块）
- 文档同步更新（README、study 文档或注释）

### 3. 高质量 PR 的特征

一个易 review 的 PR 通常包含：

- 明确变更目的
- 关键设计说明
- 风险点与回滚方式
- 测试范围与结果

---

## 💻 代码阅读（40 分钟）

### 任务 1：阅读贡献说明（10 分钟）

查看：

- `README.md`
- `README_zh.md`
- `SECURITY.md`

重点关注：

- 项目定位与维护边界
- 安全相关披露规范

### 任务 2：阅读项目配置（15 分钟）

打开：`pyproject.toml`

重点关注：

- 依赖分组
- 工具链配置（测试、格式化、类型检查）

### 任务 3：阅读已有测试覆盖（15 分钟）

查看 `tests/` 目录，确认你对“改哪测哪”的覆盖策略是否可落地。

---

## 🔧 实践操作（45 分钟）

### 练习 1：准备一份标准变更（20 分钟）

从第 15-20 章任一改动中选择一个，整理为独立变更：

- 代码变更
- 测试补充
- 文档更新

### 练习 2：编写 PR 描述（15 分钟）

PR 模板至少包含：

- 背景与目标
- 改动点摘要
- 测试结果
- 风险与兼容性说明

### 练习 3：自审清单（10 分钟）

提交前执行：

- 本地测试通过
- 无明显无关改动
- 提交信息可读（动词开头，说明范围）

---

## ✅ 本章检查清单

- [ ] 我能独立完成一次标准贡献流程
- [ ] 我的变更包含代码、测试、文档三部分
- [ ] 我能写出结构清晰的 PR 描述
- [ ] 我形成了可复用的提交前自审习惯

---

**学习进度：** [█████████████████████] 21/21 章节  
**本阶段完成后进入：** [里程碑 3：实战综合测试](./milestone03.md)
